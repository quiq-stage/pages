<!-- See https://developers.goquiq.com/docs/ui-extensions/ for more info -->
<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Cache-Control" content="no-cache" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>FlightHub RHS</title>
</head>

<script src="https://flighthub.goquiq.com/app/ui-extensions/sdk.js"></script>

<script type="text/javascript">
  Quiq.init("https://flighthub.goquiq.com");
  var userId = Quiq.getUserId();
  var conversation = Quiq.getConversation();
  setTimeout(function(){
    servicedeskTicketNumber = conversation.custom.servicedeskTicketNumber;
    console.log(userId, servicedeskTicketNumber);
  
    if (userId == "quiq-hosting1" || userId == "kristin.strickland_quiq.com#EXT#@flighthubgroup.onmicrosoft.com") {
      window.top.postMessage(
        {
          type: "SERVICEDESK_OPEN_TICKET", 
          servicedeskTicketNumber
        },
        "*" // You can replace * with your CRM domain for security
      );
    }
  }, 2000);

  /*
  async init(flex: typeof Flex, manager: Flex.Manager): Promise<void> {
    flex.Actions.addListener("afterAcceptTask", (payload) => {
      try {
        const { attributes } = payload. task;
        const ticketNumber = attributes.servicedeskTicketNumber || "unknown";
        
        window.parent.postMessage(
          {
            type: "SERVICEDESK_OPEN_TICKET", 
            ticketNumber, 
            callSid: attributes.call_sid
          },
          "*" // You can replace * with your CRM domain for security
        );
    }  catch (err) {}
        console.error ("Error posting OPEN_TICKET message:", err);
    }
  }
  */
</script>
  
<body>


</body>
</html>
